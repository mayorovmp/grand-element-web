<ngx-smart-modal #orderAddModal identifier="orderAddModal" (onOpen)="onOpen()">
  <div class="form-container">
    <h2 class="form-title">Редактор</h2>
    <div class="form-block">
      <label for="clients" class="form-block__label">
        Клиент
      </label>
      <select
        [disabled]="isShort"
        class="form-block__select"
        id="clients"
        [(ngModel)]="request.client"
        [compareWith]="byId"
        (change)="onReqModelChange()"
      >
        <option [ngValue]="undefined"></option>
        <option *ngFor="let client of clients" [ngValue]="client">
          {{ client.name }}
        </option>
      </select>
      <i (click)="addClient()" class="ml-2 fa fa-plus" aria-hidden="true"></i>
    </div>
    <div class="form-block">
      <label for="deliveryAddress" class="form-block__label">
        Адрес доставки
      </label>
      <select
        [disabled]="!request.client || isShort"
        class="form-block__select"
        [(ngModel)]="request.deliveryAddress"
        id="deliveryAddress"
        [compareWith]="byId"
        (change)="onReqModelChange()"
      >
        <option
          *ngFor="let address of request.client?.addresses"
          [ngValue]="address"
        >
          {{ address.name }}
        </option>
      </select>
    </div>
    <div class="form-block">
      <label for="longTermCheckbox" class="form-block__label">
        Долгосрочная заявка
      </label>
      <input
        [disabled]="isShort"
        type="checkbox"
        class="form-block__input"
        id="longTermCheckbox"
        [(ngModel)]="request.isLong"
      />
    </div>
    <div class="form-block" *ngIf="request.isLong">
      <label for="deliveryStart" class="form-block__label">
        Дата с
      </label>
      <input
        type="date"
        name="bday"
        [ngModel]="request.deliveryStart | date: 'yyyy-MM-dd'"
        (ngModelChange)="request.deliveryStart = $event"
        min="1000-01-01"
        max="3000-12-31"
        id="deliveryStart"
        class="form-block__input"
      />
    </div>
    <div class="form-block" *ngIf="request.isLong">
      <label for="deliveryEnd" class="form-block__label">
        Дата по
      </label>
      <input
        type="date"
        name="bday"
        [ngModel]="request.deliveryEnd | date: 'yyyy-MM-dd'"
        (ngModelChange)="request.deliveryEnd = $event"
        min="1000-01-01"
        max="3000-12-31"
        id="deliveryEnd"
        class="form-block__input"
      />
    </div>
    <div class="form-block">
      <label for="amount" class="form-block__label">
        Объем, тн
      </label>
      <input
        type="number"
        [(ngModel)]="request.amount"
        id="amount"
        class="form-block__input"
        aria-label="Small"
        aria-describedby="inputGroup-sizing-sm"
      />
    </div>
    <div class="form-block">
      <label for="sellingPrice" class="form-block__label">
        Цена продажи
      </label>
      <input
        type="number"
        [(ngModel)]="request.sellingPrice"
        class="form-block__input"
        id="sellingPrice"
        aria-label="Small"
        aria-describedby="inputGroup-sizing-sm"
        (change)="onSellingPriceChange()"
      />
    </div>
    <div class="form-block">
      <label for="product" class="form-block__label">
        Товар
      </label>
      <select
        [disabled]="isShort"
        class="form-block__input"
        [(ngModel)]="request.product"
        (ngModelChange)="onProductChange(request.product?.id)"
        id="product"
        [compareWith]="byId"
      >
        <option [ngValue]="undefined"></option>
        <option *ngFor="let product of products" [ngValue]="product">
          {{ product.name }}
        </option>
      </select>
    </div>

    <div *ngIf="!request.isLong" class="req mt-2">
      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Поставщик</div>
          </span>
        </div>
        <select
          class="form-control"
          [(ngModel)]="request.supplier"
          id="exampleFormControlSelect1"
          (ngModelChange)="onSupplierChange()"
          [compareWith]="byId"
        >
          <option [ngValue]="undefined"></option>
          <option *ngFor="let supplier of suppliers" [ngValue]="supplier">
            {{ supplier.name }}
          </option>
        </select>
        <i
          (click)="addSupplier()"
          class="ml-2 fa fa-plus"
          aria-hidden="true"
        ></i>
      </div>

      <div class="form-check">
        <input
          disabled
          type="checkbox"
          [ngModel]="request.supplierVat"
          id="supplierVat"
          class="form-check-input"
        />
        <label class="form-check-label" for="supplierVat"
          >Поставщик без НДС</label
        >
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Цена закупки</div>
          </span>
        </div>
        <input
          disabled
          type="number"
          [ngModel]="request.purchasePrice"
          class="form-control"
          aria-label="Small"
          aria-describedby="inputGroup-sizing-sm"
          (change)="calcSellingCost()"
        />
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Перевозчик</div>
          </span>
        </div>
        <select
          class="form-control"
          [(ngModel)]="request.car"
          (change)="onCarChange()"
          [compareWith]="byId"
        >
          <option [ngValue]="undefined"></option>
          <option *ngFor="let car of cars" [ngValue]="car">
            {{ car.owner }}
          </option>
        </select>
      </div>

      <div class="form-check">
        <input
          disabled
          type="checkbox"
          [ngModel]="request.carVat"
          class="form-check-input"
          id=""
        />
        <label class="form-check-label" for="exampleCheck1"
          >Перевозка НДС включен</label
        >
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Еденицы измерения</div>
          </span>
        </div>
        <input
          disabled
          type="text"
          class="form-control"
          aria-label="Small"
          [(ngModel)]="request.unit"
          aria-describedby="inputGroup-sizing-sm"
        />
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Цена перевозки за ед.</div>
          </span>
        </div>
        <input
          disabled
          type="number"
          class="form-control"
          [ngModel]="request.freightPrice"
          aria-label="Small"
          aria-describedby="inputGroup-sizing-sm"
          (change)="onFreightPriceChange()"
        />
      </div>
      <div class="mb-2">
        <div class="input-group input-group-sm mb-3">
          <div class="input-group-prepend">
            <span class="input-group-text" id="inputGroup-sizing-sm">
              <div class="label">Категория машины</div>
            </span>
          </div>

          <select
            disabled
            class="form-control"
            [ngModel]="request.car?.carCategory?.id"
            id="exampleFormControlSelect1"
          >
            <option
              *ngFor="let carCategory of carCategories"
              [ngValue]="carCategory.id"
            >
              {{ carCategory.name }}
            </option>
          </select>
        </div>
      </div>
    </div>
    <div *ngIf="!request.isLong" class="req mt-2">
      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Вход, тн</div>
          </span>
        </div>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="request.amountIn"
          aria-label="Small"
          aria-describedby="inputGroup-sizing-sm"
        />
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Выход, тн</div>
          </span>
        </div>
        <input
          type="number"
          class="form-control"
          [(ngModel)]="request.amountOut"
          aria-label="Small"
          aria-describedby="inputGroup-sizing-sm"
          (change)="onAmountChange()"
        />
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Стоимость перевозки</div>
          </span>
        </div>
        <input
          disabled
          type="number"
          class="form-control"
          aria-label="Small"
          [ngModel]="request.freightCost"
          aria-describedby="inputGroup-sizing-sm"
          (change)="calcProfit()"
        />
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Выручка</div>
          </span>
        </div>
        <input
          disabled
          type="number"
          class="form-control"
          aria-label="Small"
          [ngModel]="request.sellingCost"
          aria-describedby="inputGroup-sizing-sm"
        />
      </div>

      <div class="input-group input-group-sm mb-3">
        <div class="input-group-prepend">
          <span class="input-group-text" id="inputGroup-sizing-sm">
            <div class="label">Прибыль</div>
          </span>
        </div>
        <ng-container *ngIf="!request.supplierVat || !request.carVat">
          <input
            disabled
            type="number"
            class="form-control"
            aria-label="Small"
            [ngModel]="request.profit"
            aria-describedby="inputGroup-sizing-sm"
            (change)="calcProfit()"
          />
        </ng-container>
      </div>
    </div>

    <div class="form-block">
      <label for="reward" class="form-block__label">
        Вознаграждение
      </label>
      <input
        type="number"
        class="form-block__input"
        id="reward"
        aria-label="Small"
        [(ngModel)]="request.reward"
        aria-describedby="inputGroup-sizing-sm"
        (change)="calcProfit()"
      />
    </div>
    <div class="form-block">
      <label for="comment" class="form-block__label">
        Комментарий
      </label>
      <input
        type="text"
        class="form-block__input"
        id="comment"
        [(ngModel)]="request.comment"
        aria-label="Small"
        aria-describedby="inputGroup-sizing-sm"
      />
    </div>
  </div>
  <button
    (click)="createOrUpdate(request, parentRequestId)"
    class="app-btn gray-btn"
  >
    Создать
  </button>
</ngx-smart-modal>
<app-client-editor (changed)="onClientAdd()"></app-client-editor>
<app-supplier-editor (changed)="onSupplierAdd()"></app-supplier-editor>
